<!-- ... semua bagian sebelum ini tetap sama ... -->

<!-- Form Withdraw -->
<div id="withdrawForm">
  <input type="number" id="withdrawAmount" placeholder="Jumlah Poin yang ingin diwithdraw" /><br />
  <input type="text" id="withdrawDana" placeholder="Nomor Dana kamu" /><br />
  <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
    <button id="submitWithdraw">Submit Withdraw</button>
    <button id="cancelWithdraw" style="background-color: #444; color: white;">Batalkan</button>
  </div>
  <div id="withdrawMessage"></div>
</div>

<script>
  const username = localStorage.getItem('currentUser');
  if (!username) window.location.href = 'index.html';

  const CLAIM_REWARD = 1000;
  const COOLDOWN_MS = 24 * 60 * 60 * 1000;

  const totalEl = document.getElementById('totalRewards');
  const dailyEl = document.getElementById('dailyRewards');
  const claimBtn = document.getElementById('claimBtn');
  const statusText = document.getElementById('statusText');
  const logoutBtn = document.getElementById('logoutBtn');

  let lastClaim = localStorage.getItem(username + "_lastClaim");
  let totalReward = parseFloat(localStorage.getItem(username + "_totalReward") || "0");

  function updateUI() {
    const now = Date.now();
    let last = lastClaim ? parseInt(lastClaim) : 0;
    let elapsed = now - last;
    let canClaim = elapsed >= COOLDOWN_MS;

    if (canClaim) {
      dailyEl.textContent = CLAIM_REWARD.toFixed(3);
      claimBtn.disabled = false;
      statusText.textContent = "Kamu bisa klaim sekarang!";
    } else {
      let progress = elapsed / COOLDOWN_MS;
      dailyEl.textContent = (CLAIM_REWARD * progress).toFixed(3);
      claimBtn.disabled = true;
      let sisa = Math.ceil((COOLDOWN_MS - elapsed) / 3600000);
      statusText.textContent = `Tunggu ${sisa} jam lagi untuk klaim berikutnya.`;
    }

    totalEl.textContent = totalReward.toFixed(3);
  }

  claimBtn.onclick = () => {
    totalReward += CLAIM_REWARD;
    localStorage.setItem(username + "_totalReward", totalReward);
    lastClaim = Date.now();
    localStorage.setItem(username + "_lastClaim", lastClaim);
    updateUI();
  };

  logoutBtn.onclick = () => {
    localStorage.removeItem("currentUser");
    window.location.href = "index.html";
  };

  // Withdraw Logic
  const withdrawBtn = document.getElementById("withdrawBtn");
  const withdrawForm = document.getElementById("withdrawForm");
  const submitWithdraw = document.getElementById("submitWithdraw");
  const cancelWithdraw = document.getElementById("cancelWithdraw");
  const withdrawMessage = document.getElementById("withdrawMessage");

  withdrawBtn.onclick = () => {
    withdrawForm.style.display = "block";
    withdrawMessage.textContent = "";
  };

  submitWithdraw.onclick = () => {
    const amount = document.getElementById("withdrawAmount").value;
    const dana = document.getElementById("withdrawDana").value;

    if (!amount || !dana) {
      withdrawMessage.textContent = "Harap isi semua field!";
      withdrawMessage.style.color = "red";
      return;
    }

    withdrawMessage.textContent = "Withdraw berhasil!";
    withdrawMessage.style.color = "lime";

    document.getElementById("withdrawAmount").value = "";
    document.getElementById("withdrawDana").value = "";

    setTimeout(() => {
      withdrawForm.style.display = "none";
      withdrawMessage.textContent = "";
    }, 1000);
  };

  cancelWithdraw.onclick = () => {
    document.getElementById("withdrawAmount").value = "";
    document.getElementById("withdrawDana").value = "";
    withdrawForm.style.display = "none";
    withdrawMessage.textContent = "";
  };

  updateUI();
  setInterval(updateUI, 1000);
</script>
