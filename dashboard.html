<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard - Cloud Sync</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        /* CSS ASLI ANDA (TIDAK ADA YANG DIHAPUS) */
        body { background-color: #f1f8e9; color: #333; font-family: Arial, sans-serif; margin: 0; padding: 0; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #1a237e, #3949ab); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .profile-section { display: flex; align-items: center; gap: 10px; }
        .profile-pic { width: 40px; height: 40px; border-radius: 50%; border: 2px solid white; object-fit: cover; cursor: pointer; }
        .profile-name { font-weight: bold; font-size: 14px; }
        .profile-email { font-size: 12px; opacity: 0.8; }
        .rewards-section { padding: 20px; display: flex; gap: 15px; justify-content: center; }
        .reward-card { flex: 1; background: linear-gradient(135deg, #ff9800, #ff5722); color: white; padding: 15px; border-radius: 12px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 160px; }
        .reward-value { font-size: 22px; font-weight: bold; }
        .logo-section { text-align: center; padding: 10px 0; }
        .logo { width: 100px; height: auto; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .status-text { text-align: center; padding: 10px; font-weight: bold; min-height: 24px; color: #1b5e20; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #050505; display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; }
        .nav-btn { background: none; border: none; color: white; display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 11px; text-decoration: none; cursor: pointer; }
        .nav-icon { width: 24px; height: 24px; }
        .notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #4caf50; color: white; padding: 12px 20px; border-radius: 8px; z-index: 3000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <div id="notification" class="notification"></div>

    <div class="header">
        <div class="profile-section">
            <img id="userPhoto" src="https://i.postimg.cc/N0yJZkQv/default-avatar.png" class="profile-pic" alt="Profile">
            <div>
                <div class="profile-name" id="usernameDisplay">@username</div>
                <div class="profile-email" id="userEmail">email@user.com</div>
            </div>
        </div>
        <button style="background:none; border:none; color:white; font-size:20px;" onclick="location.reload()">üîÑ</button>
    </div>

    <div class="rewards-section">
        <div class="reward-card">
            <div class="reward-title">GOV BALANCE</div>
            <div class="reward-value" id="totalRewards">0</div>
        </div>
        <div class="reward-card">
            <div class="reward-title">EST. REWARD</div>
            <div class="reward-value" id="estReward">500</div>
        </div>
    </div>

    <div class="logo-section">
        <img src="https://i.postimg.cc/x8XVRwZS/file-00000000f3d06230a63b9cde063aaecc-1.png" class="logo" alt="Logo">
    </div>

    <div id="statusText" class="status-text">‚è≥ Memuat data...</div>

    <div style="display: flex; justify-content: center; gap: 10px; padding: 20px;">
        <button onclick="window.open('https://vast-size.com/ULT3Sw')" style="flex:1; padding:15px; border-radius:10px; border:none; background:#d32f2f; color:white; font-weight:bold;">üìΩÔ∏è Video Ads</button>
        <button id="claimBtn" style="flex:1; padding:15px; border-radius:10px; border:none; background:#4caf50; color:white; font-weight:bold;">üí∞ CLAIM GOV</button>
    </div>

    <div class="bottom-nav">
        <a href="#" class="nav-btn"><img src="https://img.icons8.com/fluency/48/home.png" class="nav-icon"><span>Home</span></a>
        <a href="wallet.html" class="nav-btn"><img src="https://img.icons8.com/fluency/48/wallet.png" class="nav-icon"><span>Wallet</span></a>
        <a href="#" onclick="alert('Referral: ' + localStorage.getItem('currentUser'))" class="nav-btn"><img src="https://img.icons8.com/fluency/48/invite.png" class="nav-icon"><span>Invite</span></a>
    </div>

    <script>
        // === 1. CONFIG FIREBASE (SAMA DENGAN WALLET) ===
        const firebaseConfig = {
            apiKey: "AIzaSyBY7wHgWh7_0HqRLHzDnwdfQOhv_ziqA3A",
            authDomain: "govin-28f84.firebaseapp.com",
            databaseURL: "https://govin-28f84-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "govin-28f84",
            storageBucket: "govin-28f84.firebasestorage.app",
            messagingSenderId: "833155210577",
            appId: "1:833155210577:web:bc3ab48e50732670a77067"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // === 2. VARIABLE SISTEM ===
        let currentSaldo = 0;
        let lastClaim = 0;
        const COOLDOWN = 60 * 60 * 1000; // 1 Jam
        const REWARD_AMOUNT = 500;

        // === 3. FUNGSI LOGIKA (DIPERBAIKI) ===
        function init() {
            const email = localStorage.getItem("currentUser");
            if (!email) { window.location.href = "index.html"; return; }
            
            document.getElementById("userEmail").textContent = email;
            document.getElementById("usernameDisplay").textContent = "@" + email.split("@")[0];

            const uid = btoa(email).replace(/=/g,'');

            // Ambil Saldo Real-time dari Firebase (Agar sinkron dengan Wallet)
            db.ref('wallets/' + uid + '/balances/GOV').on('value', (snap) => {
                currentSaldo = snap.val() || 0;
                document.getElementById("totalRewards").textContent = currentSaldo.toLocaleString();
            });

            // Cek Waktu Klaim Terakhir (LocalStorage tetap dipakai untuk cooldown per device)
            lastClaim = parseInt(localStorage.getItem(`lastClaim_${uid}`)) || 0;
            updateTimer();
            setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const now = Date.now();
            const elapsed = now - lastClaim;
            const btn = document.getElementById("claimBtn");

            if (elapsed < COOLDOWN) {
                const remain = COOLDOWN - elapsed;
                const m = Math.floor(remain / 60000);
                const s = Math.floor((remain % 60000) / 1000);
                document.getElementById("statusText").textContent = `‚è≥ Tunggu ${m}m ${s}s lagi`;
                btn.style.opacity = "0.5";
                btn.disabled = true;
            } else {
                document.getElementById("statusText").textContent = "‚úÖ Saldo siap diklaim!";
                btn.style.opacity = "1";
                btn.disabled = false;
            }
        }

        async function processClaim() {
            const email = localStorage.getItem("currentUser");
            const uid = btoa(email).replace(/=/g,'');
            
            // Tambah Saldo
            const newSaldo = currentSaldo + REWARD_AMOUNT;
            
            try {
                // UPDATE KE FIREBASE (Agar Wallet Terupdate)
                await db.ref('wallets/' + uid + '/balances/GOV').set(newSaldo);
                
                // Simpan Waktu Klaim
                lastClaim = Date.now();
                localStorage.setItem(`lastClaim_${uid}`, lastClaim);
                
                showNotification(`üéâ Berhasil klaim ${REWARD_AMOUNT} GOV!`);
                updateTimer();
            } catch (e) {
                alert("Gagal sinkron ke Cloud!");
            }
        }

        function showNotification(msg) {
            const n = document.getElementById("notification");
            n.textContent = msg; n.style.display = "block";
            setTimeout(() => n.style.display = "none", 3000);
        }

        // Jalankan
        document.getElementById("claimBtn").onclick = processClaim;
        init();
    </script>
</body>
</html>
