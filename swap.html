<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Swap DAT, DANA & USDT</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #f0f4ff, #d9ecff);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .swap-box {
      background: white;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    .swap-box h2 {
      margin: 0 0 20px;
      font-size: 24px;
      text-align: center;
      color: #333;
    }
    .input-group {
      margin-bottom: 16px;
    }
    .label {
      font-size: 14px;
      color: #555;
      margin-bottom: 6px;
    }
    .input-field {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f5f5f5;
      border-radius: 12px;
      padding: 12px;
    }
    .input-field input {
      border: none;
      background: transparent;
      font-size: 16px;
      width: 100%;
      outline: none;
    }
    .token-select {
      margin-left: 12px;
      font-weight: bold;
    }
    .arrow {
      text-align: center;
      margin: 16px 0;
      font-size: 24px;
    }
    .slippage {
      font-size: 12px;
      text-align: right;
      color: #888;
      margin-bottom: 12px;
    }
    .swap-button {
      width: 100%;
      background: #00c853;
      color: white;
      border: none;
      padding: 14px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    .swap-button:hover {
      background: #00b34d;
    }
  </style>
</head>
<body>
  <div class="swap-box">
    <h2>Exchange</h2>

    <!-- From -->
    <div class="input-group">
      <div class="label">From</div>
      <div class="input-field">
        <input type="number" id="fromAmount" placeholder="0.0" />
        <select id="fromToken" class="token-select">
          <option value="DAT">DAT</option>
          <option value="DANA">DANA</option>
          <option value="USDT">USDT</option>
        </select>
      </div>
      <div id="fromSaldo" style="font-size: 12px; color: #666; text-align: right; margin-top: 4px;"></div>
    </div>

    <div class="arrow">↓</div>

    <!-- To -->
    <div class="input-group">
      <div class="label">To</div>
      <div class="input-field">
        <input type="number" id="toAmount" placeholder="0.0" disabled />
        <select id="toToken" class="token-select">
          <option value="DANA">DANA</option>
          <option value="DAT">DAT</option>
          <option value="USDT">USDT</option>
        </select>
      </div>
      <div id="toSaldo" style="font-size: 12px; color: #666; text-align: right; margin-top: 4px;"></div>
    </div>

    <div class="slippage">Slippage Tolerance: 0.8%</div>
    <button class="swap-button" onclick="prosesSwap()">Swap Sekarang</button>
  </div>

  <script>
    const username = localStorage.getItem("currentUser") || "user";

    let saldo = {
      DAT: parseFloat(localStorage.getItem(username + "_totalReward") || "0"),
      DANA: parseFloat(localStorage.getItem(username + "_totalDANA") || "0"),
      USDT: parseFloat(localStorage.getItem(username + "_totalUSDT") || "0")
    };

    const rates = {
      "DAT_DANA": 0.5,
      "DANA_DAT": 2,
      "DAT_USDT": 0.00003165,
      "USDT_DAT": 3
    };

    const fromAmount = document.getElementById("fromAmount");
    const toAmount = document.getElementById("toAmount");
    const fromToken = document.getElementById("fromToken");
    const toToken = document.getElementById("toToken");
    const fromSaldo = document.getElementById("fromSaldo");
    const toSaldo = document.getElementById("toSaldo");

    function updateSaldoTampilan() {
      fromSaldo.textContent = "Saldo: " + (saldo[fromToken.value] || 0).toLocaleString('en-US') + " " + fromToken.value;
      toSaldo.textContent = "Saldo: " + (saldo[toToken.value] || 0).toLocaleString('en-US') + " " + toToken.value;
    }

    function updateConversion() {
      const amount = parseFloat(fromAmount.value) || 0;
      const key = `${fromToken.value}_${toToken.value}`;
      const rate = rates[key];

      if (!rate) {
        toAmount.value = "0.0";
        return;
      }

      toAmount.value = (amount * rate).toFixed(2);
    }

    fromAmount.addEventListener("input", updateConversion);
    fromToken.addEventListener("change", () => {
      updateSaldoTampilan();
      updateConversion();
    });
    toToken.addEventListener("change", () => {
      updateSaldoTampilan();
      updateConversion();
    });

    function prosesSwap() {
      const amount = parseFloat(fromAmount.value);
      const from = fromToken.value;
      const to = toToken.value;
      const rate = rates[`${from}_${to}`];

      if (!rate) {
        alert("Pasangan token tidak valid.");
        return;
      }

      if (!amount || amount <= 0) {
        alert("Masukkan jumlah yang valid.");
        return;
      }

      if (saldo[from] < amount) {
        alert(`❌ Saldo ${from} tidak cukup!`);
        return;
      }

      const hasil = amount * rate;

      saldo[from] -= amount;
      saldo[to] += hasil;

      localStorage.setItem(username + "_totalReward", saldo["DAT"]);
      localStorage.setItem(username + "_totalDANA", saldo["DANA"]);
      localStorage.setItem(username + "_totalUSDT", saldo["USDT"]);

      updateSaldoTampilan();
      fromAmount.value = "";
      toAmount.value = "";

      alert(`✅ Swap berhasil!\n${amount} ${from} ➝ ${hasil.toFixed(2)} ${to}`);
    }

    updateSaldoTampilan();
    updateConversion();
  </script>
</body>
</html>
