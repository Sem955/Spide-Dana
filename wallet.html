<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dompet Saya</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #000;
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container { 
            max-width: 500px; 
            margin: auto;
            background: #000;
        }
        
        /* Header */
        .header {
            text-align: left;
            margin-bottom: 25px;
            padding-top: 10px;
        }
        
        .header h1 { 
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: white;
        }
        
        .header .subtitle { 
            color: #8e8e93; 
            font-size: 14px; 
            font-weight: 400;
        }
        
        /* Total Balance */
        .total-balance {
            background: linear-gradient(145deg, #1c1c1e, #2c2c2e);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #3a3a3c;
        }
        
        .total-balance-label {
            color: #8e8e93;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .total-balance-amount {
            font-size: 36px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }
        
        .total-balance-change {
            color: #ff3b30;
            font-size: 14px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .action-btn {
            background: #1c1c1e;
            border: none;
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:hover {
            background: #2c2c2e;
            transform: translateY(-2px);
        }
        
        .action-btn-icon {
            font-size: 24px;
            margin-bottom: 8px;
            width: 40px;
            height: 40px;
            background: #3a3a3c;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn-text {
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Token Section Header */
        .token-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 5px;
        }
        
        .token-title {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }
        
        .view-all {
            color: #0a84ff;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Token Cards Container */
        .token-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        /* Token Card */
        .token-card {
            background: #1c1c1e;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #3a3a3c;
            transition: all 0.3s ease;
        }
        
        .token-card.active {
            background: #2c2c2e;
            border-color: #0a84ff;
        }
        
        .token-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .token-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .token-icon {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
        }
        
        .token-icon.gov { background: linear-gradient(135deg, #ff6b35 0%, #ffa500 100%); }
        .token-icon.idr { background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); }
        .token-icon.usdt { background: #26a17b; }
        
        .token-name {
            font-size: 17px;
            font-weight: 600;
            color: white;
        }
        
        .token-change {
            font-size: 14px;
            color: #ff3b30;
            font-weight: 500;
        }
        
        .token-balance-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .token-balance-amount {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }
        
        .token-balance-value {
            font-size: 16px;
            color: #8e8e93;
        }
        
        /* Additional Assets */
        .additional-asset {
            background: linear-gradient(145deg, #1c1c1e, #2c2c2e);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #3a3a3c;
        }
        
        .additional-asset-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .additional-asset-icon {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: #007aff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
        }
        
        .additional-asset-name {
            font-size: 17px;
            font-weight: 600;
            color: white;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: #8e8e93;
            font-size: 12px;
            padding: 30px 0 20px;
            margin-top: 30px;
            border-top: 1px solid #3a3a3c;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: #1c1c1e;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 25px;
            border: 1px solid #3a3a3c;
        }
        
        .modal-title {
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #8e8e93;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            background: #2c2c2e;
            border: 1px solid #3a3a3c;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
            color: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #0a84ff;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }
        
        .submit-btn { 
            background: #0a84ff; 
            color: white; 
            flex: 1; 
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        
        .submit-btn:hover {
            background: #007aff;
        }
        
        .cancel-btn { 
            background: #2c2c2e; 
            color: #8e8e93; 
            flex: 1; 
            border: 1px solid #3a3a3c;
            border-radius: 12px;
            padding: 15px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .cancel-btn:hover {
            background: #3a3a3c;
            color: white;
        }
        
        /* Notification */
        #notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #30d158;
            color: white;
            padding: 16px 28px;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 600;
            z-index: 2000;
            display: none;
            animation: fadeInOut 4s ease-in-out forwards;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -20px); }
            10%, 90% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }
    </style>
</head>
<body>

<div id="notification"></div>

<div class="container">
    <!-- Header -->
    <div class="header">
        <h1>Aset saya</h1>
        <div class="subtitle">Dilindungi oleh blockchain</div>
    </div>
    
    <!-- Total Balance -->
    <div class="total-balance">
        <div class="total-balance-label">Total Aset</div>
        <div class="total-balance-amount" id="totalBalance">0.00</div>
        <div class="total-balance-change" id="balanceChange"><0,01 USD ‚ñº</div>
    </div>
    
    <!-- Action Buttons -->
    <div class="action-buttons">
        <div class="action-btn" onclick="showTransferModal()">
            <div class="action-btn-icon">üì§</div>
            <div class="action-btn-text">Transfer GOV</div>
        </div>
        <div class="action-btn" onclick="showWithdrawModal()">
            <div class="action-btn-icon">üí∏</div>
            <div class="action-btn-text">Withdraw</div>
        </div>
        <div class="action-btn" onclick="showTransactionHistory()">
            <div class="action-btn-icon">üìã</div>
            <div class="action-btn-text">Riwayat</div>
        </div>
        <div class="action-btn" onclick="showSwapModal()">
            <div class="action-btn-icon">üîÑ</div>
            <div class="action-btn-text">Swap</div>
        </div>
    </div>
    
    <!-- Token Section -->
    <div class="token-header">
        <div class="token-title">Token</div>
        <div class="view-all" onclick="showAllTokens()">
            Lihat semua <span>‚ñº</span>
        </div>
    </div>
    
    <!-- Token Cards -->
    <div class="token-cards">
        <!-- USDT Card (Active) -->
        <div class="token-card active" onclick="selectToken('USDT')">
            <div class="token-header-row">
                <div class="token-info">
                    <div class="token-icon usdt">$</div>
                    <div class="token-name">USDT</div>
                </div>
                <div class="token-change">‚ñº-0,16%</div>
            </div>
            <div class="token-balance-row">
                <div class="token-balance-amount" id="usdtBalance">0.00</div>
                <div class="token-balance-value" id="usdtValue">0 USD</div>
            </div>
        </div>
        
        <!-- GOV Card -->
        <div class="token-card" onclick="selectToken('GOV')">
            <div class="token-header-row">
                <div class="token-info">
                    <div class="token-icon gov">‚Çø</div>
                    <div class="token-name">GOV</div>
                </div>
                <div class="token-change">‚ñº-0,16%</div>
            </div>
            <div class="token-balance-row">
                <div class="token-balance-amount" id="govBalance">0</div>
                <div class="token-balance-value" id="govValue">0 USD</div>
            </div>
        </div>
        
        <!-- IDR Card -->
        <div class="token-card" onclick="selectToken('IDR')">
            <div class="token-header-row">
                <div class="token-info">
                    <div class="token-icon idr">Rp</div>
                    <div class="token-name">IDR</div>
                </div>
                <div class="token-change">‚ñº-0,16%</div>
            </div>
            <div class="token-balance-row">
                <div class="token-balance-amount" id="idrBalance">0</div>
                <div class="token-balance-value" id="idrValue">0 USD</div>
            </div>
        </div>
    </div>
    
    <!-- Additional Assets -->
    <div class="additional-asset">
        <div class="additional-asset-header">
            <div class="additional-asset-icon">$</div>
            <div class="additional-asset-name">USD T financial management yields up</div>
        </div>
    </div>
    
    <div class="footer">¬© 2025 Digital Wallet</div>
</div>

<!-- Modals -->
<!-- Transfer Modal -->
<div id="transferModal" class="modal-overlay">
    <div class="modal-content">
        <h3 class="modal-title">üì§ Transfer GOV</h3>
        
        <div class="form-group">
            <label>Email Penerima</label>
            <input type="email" id="transferEmail" placeholder="user@email.com">
        </div>
        
        <div class="form-group">
            <label>Jumlah GOV</label>
            <input type="number" id="transferAmount" placeholder="Masukkan jumlah">
        </div>
        
        <div class="form-group">
            <label>Pesan (Opsional)</label>
            <input type="text" id="transferMessage" placeholder="Ucapan selamat atau catatan">
        </div>
        
        <div style="background: #2c2c2e; padding: 16px; border-radius: 12px; margin: 20px 0; border: 1px solid #3a3a3c;">
            <strong style="color: #ff9f0a;">Info:</strong><br>
            <span style="color: #8e8e93; font-size: 14px;">
                <strong>Biaya:</strong> Gratis (0% fee)<br>
                <strong>Estimasi:</strong> Langsung sampai
            </span>
        </div>
        
        <div class="button-group">
            <button class="submit-btn" onclick="processTransfer()">üöÄ Kirim Sekarang</button>
            <button class="cancel-btn" onclick="hideTransferModal()">‚ùå Batal</button>
        </div>
    </div>
</div>

<!-- Withdraw Modal -->
<div id="withdrawModal" class="modal-overlay">
    <div class="modal-content">
        <h3 class="modal-title">üí∏ Withdraw Saldo</h3>
        
        <div class="form-group">
            <label>Pilih Jenis Saldo</label>
            <select id="withdrawType" onchange="updateWithdrawInfo()">
                <option value="USDT">USDT</option>
                <option value="IDR">Rupiah (IDR)</option>
                <option value="GOV">GOV Coin</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Jumlah <span id="minWithdrawText">(Minimal 10 USDT)</span></label>
            <input type="number" id="withdrawAmount" placeholder="Masukkan jumlah">
        </div>
        
        <div class="form-group">
            <label>Nomor DANA/OVO/GoPay</label>
            <input type="text" id="withdrawAccount" placeholder="Contoh: 081234567890">
        </div>
        
        <div class="form-group">
            <label>Email Anda (untuk konfirmasi)</label>
            <input type="email" id="withdrawEmail" placeholder="email@anda.com">
        </div>
        
        <div style="background: #2c2c2e; padding: 16px; border-radius: 12px; margin: 20px 0; border: 1px solid #3a3a3c;">
            <strong style="color: #ff9f0a;">Info:</strong>
            <div id="withdrawInfo" style="color: #8e8e93; margin-top: 8px; font-size: 14px;">
                Withdraw diproses 1x24 jam. Minimal penarikan 10 USDT.
            </div>
        </div>
        
        <div class="button-group">
            <button class="submit-btn" onclick="processWithdraw()">‚úÖ Submit Withdraw</button>
            <button class="cancel-btn" onclick="hideWithdrawModal()">‚ùå Batal</button>
        </div>
    </div>
</div>

<!-- Swap Modal -->
<div id="swapModal" class="modal-overlay">
    <div class="modal-content">
        <h3 class="modal-title">üîÑ Swap Saldo</h3>
        
        <div class="form-group">
            <label>Dari</label>
            <select id="swapFrom" onchange="updateSwapInfo()">
                <option value="GOV">GOV Coin</option>
                <option value="USDT">USDT</option>
                <option value="IDR">Rupiah (IDR)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Ke</label>
            <select id="swapTo" onchange="updateSwapInfo()">
                <option value="USDT">USDT</option>
                <option value="GOV">GOV Coin</option>
                <option value="IDR">Rupiah (IDR)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Jumlah</label>
            <input type="number" id="swapAmount" placeholder="Masukkan jumlah" oninput="updateSwapInfo()">
        </div>
        
        <div style="background: #2c2c2e; padding: 16px; border-radius: 12px; margin: 20px 0; border: 1px solid #3a3a3c;">
            <strong style="color: #ff9f0a;">Kurs Tukar:</strong><br>
            <span style="color: #8e8e93; font-size: 14px;">
                <div id="swapRate">1000 GOV = 1 USDT</div>
                <div id="swapFee">Biaya: 1%</div>
                <div id="swapReceive">Anda akan menerima: <strong>0</strong></div>
            </span>
        </div>
        
        <div class="button-group">
            <button class="submit-btn" onclick="processSwap()">‚úÖ Tukar Sekarang</button>
            <button class="cancel-btn" onclick="hideSwapModal()">‚ùå Batal</button>
        </div>
    </div>
</div>

<script>
// ===== TELEGRAM CONFIG =====
const telegramToken = '8302323286:AAEM6xferO3kn5Bfx9Gc1tNu2iGeDEhXdr4';
const telegramChatId = '5788541286';

// ===== GLOBAL VARIABLES =====
let walletData = {
    saldoGOV: 0,
    saldoIDR: 0,
    saldoUSDT: 0,
    transactions: [],
    withdrawHistory: [],
    lastSync: null,
    dashboardSync: false
};

let selectedToken = 'USDT'; // Default selected token

// ===== EXCHANGE RATES =====
const exchangeRates = {
    GOV_TO_USDT: 0.001,      // 1 GOV = 0.001 USDT (1000 GOV = 1 USDT)
    USDT_TO_GOV: 1000,       // 1 USDT = 1000 GOV
    USDT_TO_IDR: 15500,      // 1 USDT = 15,500 IDR
    IDR_TO_USDT: 1/15500,    // 1 IDR = 0.0000645 USDT
};

// ===== TOKEN SELECTION =====
function selectToken(token) {
    selectedToken = token;
    
    // Update active state
    document.querySelectorAll('.token-card').forEach(card => {
        card.classList.remove('active');
    });
    
    if (token === 'USDT') {
        document.querySelector('.token-card:nth-child(1)').classList.add('active');
    } else if (token === 'GOV') {
        document.querySelector('.token-card:nth-child(2)').classList.add('active');
    } else if (token === 'IDR') {
        document.querySelector('.token-card:nth-child(3)').classList.add('active');
    }
    
    // Update total balance display
    updateTotalBalance();
}

// ===== UPDATE DISPLAY =====
function updateDisplay() {
    // Update individual token balances
    document.getElementById('usdtBalance').textContent = walletData.saldoUSDT.toFixed(2);
    document.getElementById('govBalance').textContent = walletData.saldoGOV.toLocaleString('id-ID');
    document.getElementById('idrBalance').textContent = walletData.saldoIDR.toLocaleString('id-ID');
    
    // Update token values in USD
    const usdtValue = walletData.saldoUSDT;
    const govValue = walletData.saldoGOV * exchangeRates.GOV_TO_USDT;
    const idrValue = walletData.saldoIDR * exchangeRates.IDR_TO_USDT;
    
    document.getElementById('usdtValue').textContent = `${usdtValue.toFixed(2)} USD`;
    document.getElementById('govValue').textContent = `${govValue.toFixed(2)} USD`;
    document.getElementById('idrValue').textContent = `${idrValue.toFixed(2)} USD`;
    
    // Update total balance
    updateTotalBalance();
}

function updateTotalBalance() {
    let totalUSD = 0;
    
    switch(selectedToken) {
        case 'USDT':
            totalUSD = walletData.saldoUSDT;
            break;
        case 'GOV':
            totalUSD = walletData.saldoGOV * exchangeRates.GOV_TO_USDT;
            break;
        case 'IDR':
            totalUSD = walletData.saldoIDR * exchangeRates.IDR_TO_USDT;
            break;
    }
    
    document.getElementById('totalBalance').textContent = totalUSD.toFixed(2);
}

// ===== SWAP FUNCTIONS =====
function showSwapModal() {
    document.getElementById('swapModal').style.display = 'flex';
    updateSwapInfo();
}

function hideSwapModal() {
    document.getElementById('swapModal').style.display = 'none';
    document.getElementById('swapAmount').value = '';
}

function updateSwapInfo() {
    const from = document.getElementById('swapFrom').value;
    const to = document.getElementById('swapTo').value;
    const amount = parseFloat(document.getElementById('swapAmount').value) || 0;
    
    let rate = 0;
    let rateText = '';
    let receiveAmount = 0;
    const fee = 0.01; // 1% fee
    
    // Calculate exchange rate
    if (from === 'GOV' && to === 'USDT') {
        rate = exchangeRates.GOV_TO_USDT; // 1 GOV = 0.001 USDT
        rateText = '1000 GOV = 1 USDT';
        receiveAmount = amount * rate;
    } 
    else if (from === 'USDT' && to === 'GOV') {
        rate = exchangeRates.USDT_TO_GOV; // 1 USDT = 1000 GOV
        rateText = '1 USDT = 1000 GOV';
        receiveAmount = amount * rate;
    }
    else if (from === 'USDT' && to === 'IDR') {
        rate = exchangeRates.USDT_TO_IDR; // 1 USDT = 15,500 IDR
        rateText = '1 USDT = 15,500 IDR';
        receiveAmount = amount * rate;
    }
    else if (from === 'IDR' && to === 'USDT') {
        rate = exchangeRates.IDR_TO_USDT; // 1 IDR = 0.0000645 USDT
        rateText = '15,500 IDR = 1 USDT';
        receiveAmount = amount * rate;
    }
    else if (from === 'GOV' && to === 'IDR') {
        // 1 GOV = 15.5 IDR (karena 1000 GOV = 1 USDT = 15,500 IDR)
        rate = 15.5;
        rateText = '1 GOV = 15.5 IDR';
        receiveAmount = amount * rate;
    }
    else if (from === 'IDR' && to === 'GOV') {
        rate = 1/15.5;
        rateText = '15.5 IDR = 1 GOV';
        receiveAmount = amount * rate;
    }
    
    // Apply fee
    const netReceiveAmount = receiveAmount * (1 - fee);
    
    // Update display
    document.getElementById('swapRate').textContent = rateText;
    document.getElementById('swapFee').textContent = `Biaya: ${(fee * 100)}%`;
    
    // Format receive amount based on asset type
    let formattedReceiveAmount = '';
    if (to === 'IDR') {
        formattedReceiveAmount = netReceiveAmount.toLocaleString('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    } else if (to === 'USDT') {
        formattedReceiveAmount = netReceiveAmount.toFixed(3);
    } else if (to === 'GOV') {
        formattedReceiveAmount = netReceiveAmount.toLocaleString('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    }
    
    document.getElementById('swapReceive').innerHTML = 
        `Anda akan menerima: <strong>${formattedReceiveAmount} ${to}</strong>`;
}

function processSwap() {
    const from = document.getElementById('swapFrom').value;
    const to = document.getElementById('swapTo').value;
    const amount = parseFloat(document.getElementById('swapAmount').value);
    
    if (!amount || amount <= 0) {
        showNotification('‚ùå Jumlah tukar harus diisi', false);
        return;
    }
    
    // Cek saldo cukup
    let fromBalance = 0;
    switch(from) {
        case 'GOV': fromBalance = walletData.saldoGOV; break;
        case 'IDR': fromBalance = walletData.saldoIDR; break;
        case 'USDT': fromBalance = walletData.saldoUSDT; break;
    }
    
    if (amount > fromBalance) {
        showNotification(`‚ùå Saldo ${from} tidak mencukupi`, false);
        return;
    }
    
    // Calculate exchange rate
    let rate = 0;
    if (from === 'GOV' && to === 'USDT') {
        rate = exchangeRates.GOV_TO_USDT;
    } 
    else if (from === 'USDT' && to === 'GOV') {
        rate = exchangeRates.USDT_TO_GOV;
    }
    else if (from === 'USDT' && to === 'IDR') {
        rate = exchangeRates.USDT_TO_IDR;
    }
    else if (from === 'IDR' && to === 'USDT') {
        rate = exchangeRates.IDR_TO_USDT;
    }
    else if (from === 'GOV' && to === 'IDR') {
        rate = 15.5;
    }
    else if (from === 'IDR' && to === 'GOV') {
        rate = 1/15.5;
    }
    
    const fee = 0.01; // 1% fee
    const receiveAmount = amount * rate * (1 - fee);
    
    // Kurangi saldo from
    switch(from) {
        case 'GOV': walletData.saldoGOV -= amount; break;
        case 'IDR': walletData.saldoIDR -= amount; break;
        case 'USDT': walletData.saldoUSDT -= amount; break;
    }
    
    // Tambah saldo to
    switch(to) {
        case 'GOV': walletData.saldoGOV += receiveAmount; break;
        case 'IDR': walletData.saldoIDR += receiveAmount; break;
        case 'USDT': walletData.saldoUSDT += receiveAmount; break;
    }
    
    // Add transaction
    addTransaction('SWAP', `Swap ${amount} ${from} ke ${receiveAmount.toFixed(2)} ${to}`, receiveAmount);
    
    saveWalletData();
    updateDisplay();
    
    showNotification(`‚úÖ Berhasil swap ${amount} ${from} ke ${receiveAmount.toFixed(2)} ${to}!`);
    hideSwapModal();
}

// ===== INITIALIZE =====
function initializeApp() {
    console.log("üöÄ Initializing Wallet App...");
    
    // Load user info
    const userEmail = localStorage.getItem('currentUser');
    if (userEmail) {
        document.getElementById('subtitle').textContent += ` | ${userEmail}`;
    }
    
    // Load wallet data
    loadWalletData();
}

// ===== LOAD WALLET DATA =====
function loadWalletData() {
    console.log("üìÇ Loading wallet data...");
    
    const userEmail = localStorage.getItem('currentUser');
    if (!userEmail) {
        console.log("No user logged in");
        updateDisplay();
        return;
    }
    
    try {
        const walletKey = `walletData_${userEmail}`;
        const savedData = localStorage.getItem(walletKey);
        
        if (savedData) {
            walletData = JSON.parse(savedData);
            console.log("‚úÖ Wallet data loaded");
            
            // Check if this is new user from dashboard
            checkForNewUserBonus();
            
        } else {
            // Coba load dari dashboard data
            loadFromDashboard();
        }
        
        updateDisplay();
        
    } catch (error) {
        console.error("‚ùå Error loading wallet:", error);
        showNotification("‚ùå Gagal memuat data wallet", false);
    }
}

// ===== CHECK FOR NEW USER BONUS =====
function checkForNewUserBonus() {
    const userEmail = localStorage.getItem('currentUser');
    if (!userEmail) return;
    
    const username = userEmail.split('@')[0];
    const dashboardKey = `userData_${username}`;
    const savedData = localStorage.getItem(dashboardKey);
    
    if (savedData) {
        const dashboardData = JSON.parse(savedData);
        
        // Jika dashboard punya 100 GOV dan wallet 0, berarti user baru
        if (dashboardData.saldoGOV === 100 && walletData.saldoGOV === 0) {
            console.log("üÜï New user detected, syncing 100 GOV from dashboard");
            walletData.saldoGOV = 100;
            
            // Add transaction
            addTransaction('BONUS', 'Bonus pendaftaran baru', 100);
            
            // Save wallet
            saveWalletData();
            updateDisplay();
            
            showNotification("üéâ Bonus 100 GOV berhasil disinkronkan!");
        }
    }
}

// ===== LOAD FROM DASHBOARD =====
function loadFromDashboard() {
    const userEmail = localStorage.getItem('currentUser');
    if (!userEmail) return;
    
    const username = userEmail.split('@')[0];
    const dashboardKey = `userData_${username}`;
    const savedData = localStorage.getItem(dashboardKey);
    
    if (savedData) {
        const dashboardData = JSON.parse(savedData);
        
        // Sync dengan dashboard
        walletData.saldoGOV = dashboardData.saldoGOV || 0;
        walletData.saldoIDR = dashboardData.saldoIDR || 0;
        walletData.saldoUSDT = dashboardData.saldoUSDT || 0;
        walletData.lastSync = new Date().toISOString();
        walletData.dashboardSync = true;
        
        console.log("üì• Loaded from dashboard");
        
        // Save wallet data
        saveWalletData();
    }
}

// ===== TRANSFER FUNCTIONS =====
function showTransferModal() {
    if (walletData.saldoGOV === 0) {
        showNotification("‚ùå Saldo GOV kosong", false);
        return;
    }
    
    document.getElementById('transferModal').style.display = 'flex';
}

function hideTransferModal() {
    document.getElementById('transferModal').style.display = 'none';
    document.getElementById('transferEmail').value = '';
    document.getElementById('transferAmount').value = '';
    document.getElementById('transferMessage').value = '';
}

function processTransfer() {
    const email = document.getElementById('transferEmail').value.trim().toLowerCase();
    const amount = parseFloat(document.getElementById('transferAmount').value);
    const message = document.getElementById('transferMessage').value.trim();
    
    const currentEmail = localStorage.getItem('currentUser') || '';
    
    // Validasi
    if (!email || !email.includes('@')) {
        showNotification('‚ùå Email penerima tidak valid', false);
        return;
    }
    
    if (email === currentEmail.toLowerCase()) {
        showNotification('‚ùå Tidak bisa transfer ke diri sendiri', false);
        return;
    }
    
    if (!amount || amount <= 0) {
        showNotification('‚ùå Jumlah transfer harus diisi', false);
        return;
    }
    
    if (amount > walletData.saldoGOV) {
        showNotification('‚ùå Saldo GOV tidak mencukupi', false);
        return;
    }
    
    // 1. Cek apakah email penerima valid
    if (!checkIfRecipientExists(email)) {
        showNotification('‚ùå Email penerima tidak terdaftar', false);
        return;
    }
    
    // 2. Kurangi saldo pengirim
    const oldSenderBalance = walletData.saldoGOV;
    walletData.saldoGOV -= amount;
    
    // 3. Tambahkan ke saldo penerima
    const transferSuccess = addToRecipientBalance(email, amount, currentEmail);
    
    if (!transferSuccess) {
        walletData.saldoGOV = oldSenderBalance;
        showNotification('‚ùå Gagal transfer ke penerima', false);
        return;
    }
    
    // 4. Kurangi juga di dashboard pengirim
    updateDashboardOnWithdraw(amount);
    
    // 5. Tambah transaksi di wallet pengirim
    addTransaction('TRANSFER', `Transfer ke ${email} ${message ? '(' + message + ')' : ''}`, -amount);
    
    // 6. Save data pengirim
    saveWalletData();
    updateDisplay();
    
    // 7. Send Telegram notification
    const telegramMsg = `
üì§ *TRANSFER GOV BERHASIL!*
üë§ Dari: ${currentEmail}
üìß Ke: ${email}
üí∞ Jumlah: ${amount} GOV
üí¨ Pesan: ${message || '-'}
üïí Waktu: ${new Date().toLocaleString()}
üìä Saldo pengirim: ${oldSenderBalance} ‚Üí ${walletData.saldoGOV} GOV
    `;
    
    sendTelegram(telegramMsg);
    
    showNotification(`‚úÖ Berhasil transfer ${amount} GOV ke ${email}!`);
    hideTransferModal();
}

// ===== WITHDRAW FUNCTIONS =====
function showWithdrawModal() {
    if (walletData.saldoGOV === 0 && walletData.saldoIDR === 0 && walletData.saldoUSDT === 0) {
        showNotification("‚ùå Saldo Anda kosong", false);
        return;
    }
    
    updateWithdrawInfo();
    document.getElementById('withdrawModal').style.display = 'flex';
}

function hideWithdrawModal() {
    document.getElementById('withdrawModal').style.display = 'none';
    document.getElementById('withdrawAmount').value = '';
    document.getElementById('withdrawAccount').value = '';
    document.getElementById('withdrawEmail').value = '';
}

function updateWithdrawInfo() {
    const type = document.getElementById('withdrawType').value;
    const minAmount = type === 'IDR' ? 200000 : type === 'USDT' ? 10 : 1000;
    const balance = type === 'IDR' ? walletData.saldoIDR : 
                    type === 'USDT' ? walletData.saldoUSDT : 
                    walletData.saldoGOV;
    
    document.getElementById('minWithdrawText').textContent = `(Minimal ${minAmount.toLocaleString()} ${type})`;
    document.getElementById('withdrawInfo').innerHTML = `
        Saldo tersedia: <strong>${balance.toLocaleString()} ${type}</strong><br>
        Minimal penarikan: <strong>${minAmount.toLocaleString()} ${type}</strong><br>
        Diproses: 1x24 jam kerja
    `;
}

function processWithdraw() {
    const type = document.getElementById('withdrawType').value;
    const amount = parseFloat(document.getElementById('withdrawAmount').value);
    const account = document.getElementById('withdrawAccount').value.trim();
    const email = document.getElementById('withdrawEmail').value.trim();
    
    const minAmount = type === 'IDR' ? 200000 : type === 'USDT' ? 10 : 1000;
    const balance = type === 'IDR' ? walletData.saldoIDR : 
                    type === 'USDT' ? walletData.saldoUSDT : 
                    walletData.saldoGOV;
    
    if (!amount || amount < minAmount) {
        showNotification(`‚ùå Minimal withdraw ${minAmount.toLocaleString()} ${type}`, false);
        return;
    }
    
    if (amount > balance) {
        showNotification(`‚ùå Saldo ${type} tidak mencukupi`, false);
        return;
    }
    
    if (!account) {
        showNotification('‚ùå Nomor rekening/dompet digital harus diisi', false);
        return;
    }
    
    if (!email || !email.includes('@')) {
        showNotification('‚ùå Email tidak valid', false);
        return;
    }
    
    // Process withdraw
    if (type === 'IDR') {
        walletData.saldoIDR -= amount;
    } else if (type === 'USDT') {
        walletData.saldoUSDT -= amount;
    } else {
        walletData.saldoGOV -= amount;
        updateDashboardOnWithdraw(amount);
    }
    
    walletData.withdrawHistory.push({
        type: type,
        amount: amount,
        account: account,
        email: email,
        timestamp: new Date().toISOString(),
        status: 'pending'
    });
    
    addTransaction('WITHDRAW', `Withdraw ${type} ke ${account}`, -amount);
    
    saveWalletData();
    updateDisplay();
    
    const telegramMsg = `
üîî *WITHDRAW BARU!*
üë§ User: ${email}
üí∞ Jumlah: ${amount.toLocaleString()} ${type}
üì± Akun: ${account}
üïí Waktu: ${new Date().toLocaleString()}
    `;
    
    sendTelegram(telegramMsg);
    
    showNotification(`‚úÖ Withdraw berhasil diproses! Akan dikirim dalam 24 jam.`);
    hideWithdrawModal();
}

// ===== SAVE WALLET DATA =====
function saveWalletData() {
    const userEmail = localStorage.getItem('currentUser');
    if (!userEmail) {
        console.log("No user, saving locally only");
        return false;
    }
    
    try {
        walletData.lastSync = new Date().toISOString();
        const walletKey = `walletData_${userEmail}`;
        localStorage.setItem(walletKey, JSON.stringify(walletData));
        
        console.log("‚úÖ Wallet data saved");
        return true;
        
    } catch (error) {
        console.error("‚ùå Error saving wallet:", error);
        return false;
    }
}

// ===== TRANSACTION FUNCTIONS =====
function addTransaction(type, description, amount) {
    const transaction = {
        type: type,
        description: description,
        amount: amount,
        timestamp: new Date().toISOString()
    };
    
    walletData.transactions.unshift(transaction);
    
    if (walletData.transactions.length > 50) {
        walletData.transactions = walletData.transactions.slice(0, 50);
    }
}

// ===== UTILITY FUNCTIONS =====
function showNotification(message, isSuccess = true) {
    const notification = document.getElementById("notification");
    notification.textContent = message;
    notification.style.background = isSuccess ? "#30d158" : "#ff3b30";
    notification.style.display = "block";
    
    setTimeout(() => {
        notification.style.display = "none";
    }, 4000);
}

function showTransactionHistory() {
    showNotification("Fitur riwayat transaksi akan segera hadir");
}

function showAllTokens() {
    showNotification("Menampilkan semua token...");
}

// ===== INITIALIZE =====
document.addEventListener('DOMContentLoaded', function() {
    console.log("üì± Wallet App Starting...");
    initializeApp();
    
    // Auto-save every 2 minutes
    setInterval(() => {
        saveWalletData();
    }, 120000);
});
</script>

</body>
</html>
